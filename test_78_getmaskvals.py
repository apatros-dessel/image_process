from geodata import *

files = folder_paths(r'e:\rks\razmetka\set009__20200424__mines_kanopus_pms\masks',1,'tif')
pout = r'e:\rks\razmetka\set009__20200424__mines_kanopus_pms'

codes = {
    1:  'карьеры (любые)',
    10: 'карьеры, без воды и растительности',
    11: 'карьеры, с растительностью, без воды',
    12: 'карьеры, с водой, без растительности',
    13: 'карьеры, с водой и растительностью',
    2:  'вскрытые грунты (любые)',
    20: 'вскрытые грунты, без воды и растительности',
    21: 'вскрытые грунты, с растительностью, без воды',
    22: 'вскрытые грунты, с водой, без растительности',
    23: 'вскрытые грунты, с водой и ратсительностью',
    24: 'свалки (отдельные маски для свалок с префиксом MDP)',
    25: 'полигоны ТБО',
    26: 'нарушенные земли',
    27: 'гольцы',
    3:  'площадки строительства (любые)',
    30: 'площадки строительства, без воды и растительности',
    31: 'площадки строительства, с растительностью, без воды',
    32: 'площадки строительства, с водой, без растительности',
    33: 'площадки строительства, с водой и растительностью',
    4:  'леса (любые)',
    41: 'лес на болоте',
    411:'широколиственные леса',
    41113:'широколиственные зрелые сомкнутые леса',
    41114:'широколиственные зрелые редкостойные леса',
    41123:'широколиственные молодые сомкнутые леса',
    41124:'широколиственные молодые редкостойные леса',
    412:'мелколиственные леса',
    41213:'мелколиственные зрелые сомкнутые леса',
    41214:'мелколиственные зрелые редкостойные леса',
    41223:'мелколиственные молодые сомкнутые леса',
    41224:'мелколиственные молодые редкостойные леса',
    42: 'светлохвойные леса',
    421:'лиственничники',
    42113:'лиственничники зрелые сомкнутые',
    42114:'лиственничники зрелые редкостойные',
    42123:'лиственничники молодые сомкнутые',
    42124:'лиственничники молодые редкостойные',
    422:'сосняки',
    42213:'сосняки зрелые сомкнутые',
    42214:'сосняки зрелые редкостойные',
    42223:'сосняки молодые сомкнутые',
    42224:'сосняки молодые редкостойные',
    43: 'темнохвойные леса',
    43013:'темнохвойные зрелые сомкнутые леса',
    43014:'темнохвойные зрелые редкостойные леса',
    43023:'темнохвойные молодые сомкнутые леса',
    43024:'темнохвойные молодые редкостойные леса',
    44: 'горельники (без детализации породного состава и интенсивности огня)',
    441:'горельники, пройденные верховым пожаром',
    442:'горельники, пройденные низовым пожаром',
    45: 'зарастание полей',
    5:  'здания (любые)',
    501:'застройка (по среднему и низкому разрешению)',
    51: 'жилые малоэтажные здания',
    52: 'жилые многоэтажные здания',
    53: 'промышленные, коммерческие, исторические и муниципальные здания',
    54: 'автодороги (любые)',
    541:'автодороги с покрытием',
    542:'автодороги грунтовые',
    55: 'железные дороги',
    6:  'болота',
    7:  'изменения (не используется, т.к. аналогичен 100)',
    8:  'травянистая растительность (луга, поля и т.д.)',
    81: 'поля',
    9:  'водные объекты (любые)',
    100:'изменения (любые)',
    101:'новые карьеры (любые)',
    102:'новые вскрытые грунты (любые)',
    103:'новые площадки строительства (любые)',
    140:'вырубка (любая)',
    141:'вырубка сплошная',
    142:'вырубка выборочная',
    143:'больной, высохший или сгоревший лес',
    144:'поражение леса верховым пожаром',
    145:'поражение леса низовым пожаром',
    105:'новое строительство зданий и сооружений (любых)',
    151:'новые земляные работы',
    152:'новое дорожное, линейное строительство',
    106:'новые свалки (любые)',
    107:'новое осушение (любое)',
    109:'новое затопление (любое)',
    200:'участки, непригодные для дешифрирования (любые)',
    201:'облака',
    202:'тень облаков',
    203:'дымка',
    2031:'прозрачная дымка',
    2032:'плотная дымка',
    2033:'радужная дымка (несведение каналов)',
}

msk_end_values = OrderedDict()
for file in files:
    vals = list(np.unique(gdal.Open(file).ReadAsArray()))
    for val in vals:
        if val and (not val in msk_end_values):
            if val in codes:
                msk_end_values[val] = codes[val]
            else:
                print('Unknown code: %i' % val)
                msk_end_values[val] = 'UNKNOWN'
    msk_values = ' '.join(flist(vals, str))
dict_to_csv(fullpath(pout, 'mask_values.csv'), msk_end_values)
